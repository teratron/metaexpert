# Спецификация: Реализация CLI для MetaExpert

**ID:** `spec-005-cli-implementation`
**Статус:** Предложено
**Приоритет:** Средний

## 1. Обзор

Настоящая спецификация описывает требования к созданию и реализации полноценного интерфейса командной строки (CLI) для библиотеки `MetaExpert`. Цель — предоставить пользователям удобный инструмент для управления проектами торговых экспертов, включая их создание, запуск и (в будущем) тестирование.

Текущая реализация CLI является неполной:
-   `src/metaexpert/__main__.py` пуст.
-   Отсутствует явная реализация команд в модуле `src/metaexpert/cli/`.
-   Основной способ запуска — прямой вызов Python-скриптов в примерах.

## 2. Требования

### 2.1. Технологии
-   **Фреймворк:** `Typer` (уже в зависимостях).
-   **Тестирование:** `Pytest` с использованием `Typer.testing.CliRunner`.

### 2.2. Структура файлов
-   Основная логика CLI должна быть реализована в `src/metaexpert/cli/main.py`.
-   Точка входа `src/metaexpert/__main__.py` должна импортировать и запускать `Typer`-приложение из `cli/main.py`.
-   Тесты для CLI должны располагаться в `tests/unit/test_cli.py`.

### 2.3. Команды

#### 2.3.1. `metaexpert new <project_name>` (Основная команда)

**Назначение:** Создание нового проекта торгового эксперта на основе шаблона.

**Поведение:**
1.  Принимает один аргумент: `project_name` (имя директории для нового проекта).
2.  Создает новую директорию с именем `<project_name>`.
3.  Копирует содержимое `src/metaexpert/template/template.py` в файл `<project_name>/main.py`.
4.  Создает базовый `pyproject.toml` для нового проекта, включая зависимость от `metaexpert`.
5.  Создает файл `.env.example` со всеми необходимыми переменными окружения (API ключи, секреты и т.д.).
6.  Выводит в консоль сообщение об успешном создании проекта и инструкцию по дальнейшим шагам (например, "Проект `my_expert` успешно создан. Перейдите в директорию и установите зависимости.").

**Пример:**
```shell
$ metaexpert new my_awesome_expert
> [INFO] Проект 'my_awesome_expert' успешно создан в ./my_awesome_expert
```

#### 2.3.2. `metaexpert run [path]`

**Назначение:** Запуск торгового эксперта.

**Поведение:**
1.  Принимает необязательный аргумент `path` — путь к файлу с экспертом (по умолчанию `main.py` в текущей директории).
2.  Загружает и запускает указанный скрипт эксперта.
3.  Должен поддерживать передачу параметров через опции командной строки, которые будут переопределять значения в файле эксперта.
    -   `--trade-mode` (`live`, `paper`, `backtest`)
    -   `--symbol`
    -   `--timeframe`
    -   `--log-level`

**Пример:**
```shell
# Запуск эксперта в текущей директории
$ metaexpert run

# Запуск в режиме live trading
$ metaexpert run --trade-mode live

# Запуск конкретного файла с другими параметрами
$ metaexpert run examples/my_strategy.py --symbol ETHUSDT --log-level DEBUG
```

#### 2.3.3. `metaexpert --version`

**Назначение:** Отображение текущей версии библиотеки.

**Поведение:**
1.  Читает версию из `src/metaexpert/__version__.py`.
2.  Выводит ее в консоль.

**Пример:**
```shell
$ metaexpert --version
> metaexpert, version 0.3.1
```

## 3. План реализации (TDD)

1.  **Написание тестов (Red):**
    -   Написать тест `test_cli_version` для проверки команды `--version`.
    -   Написать тест `test_cli_new_project_creation` для команды `new`, проверяющий создание директории и всех необходимых файлов (`main.py`, `pyproject.toml`, `.env.example`).
    -   Написать тест `test_cli_run` для команды `run`, используя mock-объект эксперта для проверки его запуска.
    -   Убедиться, что все тесты падают.

2.  **Реализация (Green):**
    -   Реализовать логику для `__main__.py` и `cli/main.py`.
    -   Реализовать команду `new` в соответствии с требованиями.
    -   Реализовать команду `run` и `--version`.
    -   Запустить тесты и добиться их прохождения.

3.  **Рефакторинг (Refactor):**
    -   Проверить код на соответствие стандартам `Ruff` и `Pyright`.
    -   Улучшить читаемость и структуру кода CLI.

## 4. Обновление документации

-   Создать новый файл `docs/guides/cli.md`, описывающий все команды, их аргументы и опции.
-   Обновить `README.md`, добавив раздел про использование CLI.