# Backtesting a Strategy

This guide explains how to backtest a trading strategy using the MetaExpert CLI.

## Prerequisites

- MetaExpert CLI installed
- A strategy implemented in a Python file (e.g., `main.py`)
- Historical market data (automatically fetched by MetaExpert)

## Step-by-Step Guide

### 1. Prepare Your Strategy

Ensure your strategy is implemented in a Python file. For this example, we'll use `main.py`:

```python
# main.py
from metaexpert.core.expert import Expert
from metaexpert.exchanges.binance import BinanceExchange

class MyStrategy(Expert):
    def __init__(self):
        super().__init__()
        self.exchange = BinanceExchange()
        # Strategy parameters
        self.rsi_period = 14
        self.overbought = 70
        self.oversold = 30
        
    def on_tick(self):
        # Get latest price data
        ticker = self.exchange.get_ticker("BTC/USDT")
        
        # Calculate RSI
        rsi = self.calculate_rsi(self.rsi_period)
        
        # Trading logic
        if rsi < self.oversold:
            # Oversold condition - consider buying
            self.buy("BTC/USDT", 0.001)  # Buy 0.001 BTC
        elif rsi > self.overbought:
            # Overbought condition - consider selling
            self.sell("BTC/USDT", 0.001)  # Sell 0.001 BTC
            
    def calculate_rsi(self, period):
        # Simplified RSI calculation
        # In a real implementation, you would fetch historical data
        # and calculate the RSI using a proper algorithm
        return 50  # Placeholder value

if __name__ == "__main__":
    expert = MyStrategy()
    expert.run()
```

### 2. Basic Backtest

To perform a basic backtest:

```bash
metaexpert backtest main.py --start-date 2024-01-01 --end-date 2024-12-31
```

This command will backtest the strategy in `main.py` using historical data from January 1, 2024, to December 31, 2024.

### 3. Backtest with Custom Capital

To specify a custom initial capital for the backtest:

```bash
metaexpert backtest main.py --start-date 2024-01-01 --end-date 2024-12-31 --capital 50000
```

This sets the initial capital to $50,000.

### 4. Backtest with Parameter Optimization

To optimize strategy parameters:

```bash
metaexpert backtest main.py --start-date 2024-01-01 --end-date 2024-12-31 --optimize --optimize-params "rsi_period,overbought,oversold"
```

This command will optimize the `rsi_period`, `overbought`, and `oversold` parameters to find the best-performing combination.

### 5. Backtest with Strategy Comparison

To compare different strategies:

```bash
metaexpert backtest main.py --start-date 2024-01-01 --end-date 2024-12-31 --compare
```

This command will run the backtest and compare the performance of the strategy with a buy-and-hold strategy.

### 6. Backtest with Custom Report Format

To generate a backtest report in a specific format:

```bash
# Generate HTML report
metaexpert backtest main.py --start-date 2024-01-01 --end-date 2024-12-31 --report-format html

# Generate JSON report
metaexpert backtest main.py --start-date 2024-01-01 --end-date 2024-12-31 --report-format json

# Generate CSV report
metaexpert backtest main.py --start-date 2024-01-01 --end-date 2024-12-31 --report-format csv
```

### 7. Backtest with Multiple Symbols

To backtest a strategy on multiple symbols:

```bash
metaexpert backtest main.py --start-date 2024-01-01 --end-date 2024-12-31 --symbols "BTC/USDT,ETH/USDT"
```

This command will backtest the strategy on both BTC/USDT and ETH/USDT pairs.

## Understanding Backtest Results

After running a backtest, MetaExpert will display a summary of the results:

```
Backtest Results:
  Symbol: BTC/USDT
  Period: 2024-01-01 to 2024-12-31
  Initial Capital: $10,000.00
  Final Capital: $15,234.56
  Profit: $5,234.56 (52.35%)
  Trades: 120
  Win Rate: 58.33%
  Max Drawdown: 12.45%
  Sharpe Ratio: 1.87
```

### Key Metrics Explained

- **Profit**: The total profit or loss generated by the strategy.
- **Win Rate**: The percentage of winning trades.
- **Max Drawdown**: The maximum peak-to-trough decline in the equity curve.
- **Sharpe Ratio**: A measure of risk-adjusted return.

## Advanced Backtesting Techniques

### Walk-Forward Analysis

To perform walk-forward analysis:

```bash
metaexpert backtest main.py --start-date 2024-01-01 --end-date 2024-12-31 --walk-forward --window-size 90 --step-size 30
```

This command will divide the backtest period into 90-day windows, with a 30-day step between windows. The strategy will be optimized on each window and tested on the subsequent out-of-sample period.

### Monte Carlo Simulation

To perform a Monte Carlo simulation:

```bash
metaexpert backtest main.py --start-date 2024-01-01 --end-date 2024-12-31 --monte-carlo --simulations 1000
```

This command will run 1000 simulations of the strategy with randomized trade sequences to assess the robustness of the results.

## Best Practices

### 1. Use Out-of-Sample Data

Always validate your strategy on out-of-sample data to avoid overfitting.

### 2. Consider Transaction Costs

Factor in transaction costs (fees, slippage) to get a realistic assessment of performance.

### 3. Test Different Market Conditions

Backtest your strategy across different market conditions (bull, bear, sideways) to ensure robustness.

### 4. Monitor Key Risk Metrics

Pay attention to drawdown, win rate, and Sharpe ratio to evaluate the risk-return profile of your strategy.

## Conclusion

Backtesting is a crucial step in developing a profitable trading strategy. MetaExpert CLI provides powerful tools to backtest, optimize, and analyze your strategies. By following the best practices outlined in this guide, you can increase the likelihood of developing a successful trading strategy.

For more information on available backtest commands and options, see the [Command Reference](../COMMAND_REFERENCE.md).